(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{x:()=>e});var e,n=document.querySelector(".form__profile-edit"),o=document.querySelector(".form__card-add"),r=n.querySelector(".form__item_element_profile-name"),c=n.querySelector(".form__item_element_profile-activity"),i=o.querySelector(".form__item_element_cards-nameplace"),a=o.querySelector(".form__item_element_cards-link"),u=document.querySelector(".profile__name"),l=document.querySelector(".profile__activity"),s=document.querySelector(".profile__photo"),d=document.querySelector(".form__profile-photo-edit"),f=d.querySelector(".form__item_element_photo-link"),p=document.querySelector(".cards__items"),m=document.querySelector(".button_type_edit"),_=document.querySelector(".button_type_add"),y=document.querySelector(".button_type_edit-photo"),v=(document.querySelector(".form__card-delete"),document.querySelector(".popup__profile-edit")),h=document.querySelector(".popup__card-add"),b=document.querySelector(".popup__image-open"),S=document.querySelector(".popup-image"),q=document.querySelectorAll(".popup"),g=document.querySelector(".popup__profile-photo-edit"),L=(document.querySelector(".popup__card-delete"),document.querySelector(".popup-image__caption")),k=document.querySelector(".profile__edit-photo"),E=o.querySelector(".button_type_save"),C=function(t,e){!function(t){return t.every((function(t){return t.validity.valid}))}(t)?e.disabled=!0:e.disabled=!1},x="https://nomoreparties.co/v1/plus-cohort-3",T="34ec8cb0-1bba-4545-a356-d16d36203124",A="application/json";function w(t){return t.ok?t.json():Promise.reject(t.status)}function O(t){"Escape"===t.key&&P(document.querySelector(".popup_opened"))}function j(t,e,n){t&&(e.textContent="Сохранение.."),t||(e.textContent=n)}function z(t){t.classList.add("popup_opened"),document.addEventListener("keydown",O)}function P(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",O)}function N(t){var n=t.name,o=t.link,r=t.likes,c=t.owner,i=t._id,a=document.querySelector("#card").content.querySelector(".cards__item").cloneNode(!0);a.querySelector(".cards__item-name").textContent=n;var u=a.querySelector(".cards__image");u.src=o,u.alt=n;var l=a.querySelector(".cards__like-counter");l.textContent=r.length;var s=a.querySelector(".button_type_like");r.forEach((function(t){t._id===e?s.classList.add("button_type_like-active"):s.classList.remove("button_type_like-active")})),s.addEventListener("click",(function(t){var e;s.classList.contains("button_type_like-active")?(e=i,fetch("".concat(x,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:T,"Content-Type":A}}).then(w)).then((function(e){l.textContent=e.likes.length,t.target.classList.remove("button_type_like-active")})).catch((function(t){return console.log("Ошибка при лайке: ".concat(t))})):function(t,e){return fetch("".concat(x,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:T,"Content-Type":A},body:JSON.stringify({likes:void 0})}).then(w)}(i).then((function(e){l.textContent=e.likes.length,t.target.classList.add("button_type_like-active")})).catch((function(t){return console.log("Ошибка при лайке: ".concat(t))}))}));var d=a.querySelector(".button_type_delete");return c._id===e&&(d.style.display="block"),function(t,e){var n=t.querySelector(".button_type_delete");n.addEventListener("click",(function(t){var o,r=e._id,c=n.closest(".cards__item");(o=r,fetch("".concat(x,"/cards/").concat(o),{method:"DELETE",headers:{authorization:T,"Content-Type":A}}).then(w)).then((function(){c.remove()})).catch((function(t){return console.log("Ошибочка вышла: ".concat(t.status))}))}))}(a,t),u.addEventListener("click",(function(){S.src=o,L.textContent=n,S.alt=n,z(b)})),a}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}n.addEventListener("submit",(function(t){var e,n;(e=r.value,n=c.value,fetch("".concat(x,"/users/me"),{method:"PATCH",headers:{authorization:T,"Content-Type":A},body:JSON.stringify({name:e,about:n})}).then(w)).then((function(t){u.textContent=t.name,l.textContent=t.about,f.value=t.avatar,P(v)})).catch((function(t){return console.log("Ошибочка вышла: ".concat(t))})).finally((function(){return j(!1,t.submitter,"Сохранить")})),j(!0,t.submitter,"")})),o.addEventListener("submit",(function(t){var e,n;t.preventDefault(),(e=i.value,n=a.value,fetch("".concat(x,"/cards"),{method:"POST",headers:{authorization:T,"Content-Type":A},body:JSON.stringify({name:e,link:n})}).then(w)).then((function(t){p.prepend(N(t)),o.reset(),E.disabled=!0,P(h)})).catch((function(t){return console.log("Ошибочка вышла: ".concat(t))})).finally((function(){return j(!1,t.submitter,"Создать")})),j(!0,t.submitter,"")})),d.addEventListener("submit",(function(t){var e;(e=f.value,fetch("".concat(x,"/users/me/avatar"),{method:"PATCH",headers:{authorization:T,"Content-Type":A},body:JSON.stringify({avatar:e})}).then(w)).then((function(t){s.src=t.avatar,P(g)})).catch((function(t){return console.log("Ошибочка вышла: ".concat(t))})).finally((function(){return j(!1,t.submitter,"Сохранить")})),j(!0,t.submitter,"")})),Promise.all([fetch("".concat(x,"/users/me"),{headers:{authorization:T}}).then(w),fetch("".concat(x,"/cards"),{headers:{authorization:T}}).then(w)]).then((function(t){var n,o,r=(o=2,function(t){if(Array.isArray(t))return t}(n=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c=[],i=!0,a=!1;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(c.push(o.value),!e||c.length!==e);i=!0);}catch(t){a=!0,r=t}finally{try{i||null==n.return||n.return()}finally{if(a)throw r}}return c}}(n,o)||function(t,e){if(t){if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(t,e):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],i=r[1];s.src=c.avatar,u.textContent=c.name,l.textContent=c.about,e=c._id,I(i)})).catch((function(t){console.log(t)}));var J,I=function(t){t.forEach((function(t){p.append(N(t))}))};q.forEach((function(t){t.addEventListener("click",(function(e){(e.target.classList.contains("popup_opened")||e.target.classList.contains("button_type_close-window"))&&P(t)}))})),k.addEventListener("mouseover",(function(t){(t.target.classList.contains("profile__edit-photo")||t.target.classList.contains("button_type_edit-photo"))&&(y.style.visibility="visible")})),k.addEventListener("mouseout",(function(t){(t.target.classList.contains("profile__edit-photo")||t.target.classList.contains("button_type_edit-photo"))&&(y.style.visibility="hidden")})),y.addEventListener("click",(function(){z(g)})),m.addEventListener("click",(function(){r.value=u.textContent,c.value=l.textContent,z(v)})),_.addEventListener("click",(function(){z(h)})),J={inputSelector:".form__item",buttonSelector:".button_type_save",errorClass:"form__item_error"},Array.from(document.forms).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));t.addEventListener("submit",(function(t){t.preventDefault()}));var o=t.querySelector(e.buttonSelector);n.forEach((function(t){t.addEventListener("input",(function(){(function(t,e){t.validity.valid?function(t,e){document.querySelector("#".concat(t.name,"-error")).textContent="",t.classList.remove(e.errorClass)}(t,e):function(t,e){document.querySelector("#".concat(t.name,"-error")).textContent=t.validationMessage,t.classList.add(e.errorClass)}(t,e)})(t,e),C(n,o)}))})),C(n,o)}(t,J)}))})();