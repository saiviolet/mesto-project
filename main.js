(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{x:()=>T});var e="https://nomoreparties.co/v1/plus-cohort-3",n="34ec8cb0-1bba-4545-a356-d16d36203124",o="application/json";function r(){return fetch("".concat(e,"/users/me"),{headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))}function c(){return fetch("".concat(e,"/cards"),{headers:{authorization:n}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))}var i=document.querySelector(".form__profile-edit"),a=document.querySelector(".form__card-add"),u=i.querySelector(".form__item_element_profile-name"),l=i.querySelector(".form__item_element_profile-activity"),s=a.querySelector(".form__item_element_cards-nameplace"),d=a.querySelector(".form__item_element_cards-link"),f=document.querySelector(".profile__name"),m=document.querySelector(".profile__activity"),p=document.querySelector(".profile__photo"),y=document.querySelector(".form__profile-photo-edit"),_=y.querySelector(".form__item_element_photo-link"),v=document.querySelector(".cards__items"),h=document.querySelector(".button_type_edit"),b=document.querySelector(".button_type_add"),S=document.querySelector(".button_type_edit-photo");function q(t){"Escape"===t.key&&A(document.querySelector(".popup_opened"))}function k(t,e,n){t&&(e.textContent="Сохранение.."),t||(e.textContent=n)}function g(t){var r=t.name,c=t.link,i=t.likes,a=t.owner,u=t._id,l=document.querySelector("#card").content.querySelector(".cards__item").cloneNode(!0);l.querySelector(".cards__item-name").textContent=r;var s=l.querySelector(".cards__image");s.src=c,s.alt=r;var d=l.querySelector(".cards__like-counter");d.textContent=i.length;var f=l.querySelector(".button_type_like");i.forEach((function(t){t._id===T?f.classList.add("button_type_like-active"):f.classList.remove("button_type_like-active")})),f.addEventListener("click",(function(t){var r;t.target.classList.toggle("button_type_like-active"),f.classList.contains("button_type_like-active")?function(t,r){return fetch("".concat(e,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:n,"Content-Type":o},body:JSON.stringify({likes:void 0})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))}(u).then((function(t){d.textContent=t.likes.length})).catch((function(t){return console.log("Ошибка при лайке: ".concat(t))})):(r=u,fetch("".concat(e,"/cards/likes/").concat(r),{method:"DELETE",headers:{authorization:n,"Content-Type":o}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){d.textContent=t.likes.length})).catch((function(t){return console.log("Ошибка при лайке: ".concat(t))}))}));var m=l.querySelector(".button_type_delete");return a._id===T&&(m.style.display="block"),s.addEventListener("click",(function(){m.closest(".cards__item");var t=document.querySelector(".popup-image__caption");j.src=c,t.textContent=r,j.alt=r,w(E)})),l}document.querySelector(".form__card-delete");var L=document.querySelector(".popup__profile-edit"),C=document.querySelector(".popup__card-add"),E=document.querySelector(".popup__image-open"),j=document.querySelector(".popup-image"),x=document.querySelectorAll(".popup"),P=document.querySelector(".popup__profile-photo-edit");function w(t){t.classList.add("popup_opened"),document.addEventListener("keydown",q)}function A(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",q)}document.querySelector(".popup__card-delete"),i.addEventListener("submit",(function(t){var r,c;(r=u.value,c=l.value,fetch("".concat(e,"/users/me"),{method:"PATCH",headers:{authorization:n,"Content-Type":o},body:JSON.stringify({name:r,about:c})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){f.textContent=t.name,m.textContent=t.about,_.value=t.avatar})).catch((function(t){return console.log("Ошибочка вышла: ".concat(t))})).finally((function(){return k(!1,t.submitter,"Сохранить")})),A(L),k(!0,t.submitter,"")})),a.addEventListener("submit",(function(t){t.preventDefault(),(t.submitter,fetch("".concat(e,"/cards"),{method:"POST",headers:{authorization:n,"Content-Type":o},body:JSON.stringify({name:s.value,link:d.value})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){var e={name:t.name,link:t.link,likes:t.likes,owner:t.owner,_id:t._id};v.prepend(g(e)),a.reset(),a.querySelector(".button_type_save").disabled=!0})).catch((function(t){return console.log("Ошибочка вышла: ".concat(t))})).finally((function(){return k(!1,t.submitter,"Создать")})),k(!0,t.submitter,""),A(C)})),y.addEventListener("submit",(function(t){var r;(r=_.value,fetch("".concat(e,"/users/me/avatar"),{method:"PATCH",headers:{authorization:n,"Content-Type":o},body:JSON.stringify({avatar:r})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){p.src=t.avatar})).catch((function(t){return console.log("Ошибочка вышла: ".concat(t))})).finally((function(){return k(!1,t.submitter,"Сохранить")})),A(P),k(!0,t.submitter,"")}));var T,O,z=function(t,e){!function(t){return t.every((function(t){return t.validity.valid}))}(t)?e.disabled=!0:e.disabled=!1};function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}Promise.all([r(),c()]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c=[],i=!0,a=!1;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(c.push(o.value),!e||c.length!==e);i=!0);}catch(t){a=!0,r=t}finally{try{i||null==n.return||n.return()}finally{if(a)throw r}}return c}}(e,n)||function(t,e){if(t){if("string"==typeof t)return N(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0];o[1],p.src=r.avatar,f.textContent=r.name,l.textContent=r.about,T=r._id})).catch((function(t){console.log(t)})),x.forEach((function(t){t.addEventListener("click",(function(e){(e.target.classList.contains("popup_opened")||e.target.classList.contains("button_type_close-window"))&&A(t)}))})),document.addEventListener("mouseover",(function(t){t.target.classList.contains("profile__edit-photo")||t.target.classList.contains("button_type_edit-photo")?S.style.visibility="visible":S.style.visibility="hidden"})),S.addEventListener("click",(function(){w(P)})),h.addEventListener("click",(function(){w(L)})),b.addEventListener("click",(function(){w(C)})),O={inputSelector:".form__item",buttonSelector:".button_type_save",errorClass:"form__item_error"},Array.from(document.forms).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));t.addEventListener("submit",(function(t){t.preventDefault()}));var o=t.querySelector(e.buttonSelector);n.forEach((function(t){t.addEventListener("input",(function(){(function(t,e){t.validity.valid?function(t,e){document.querySelector("#".concat(t.name,"-error")).textContent="",t.classList.remove(e.errorClass)}(t,e):function(t,e){document.querySelector("#".concat(t.name,"-error")).textContent=t.validationMessage,t.classList.add(e.errorClass)}(t,e)})(t,e),z(n,o)}))})),z(n,o)}(t,O)})),r().then((function(t){f.textContent=t.name,m.textContent=t.about,p.src=t.avatar,u.value=t.name,l.value=t.about,i.querySelector(".button_type_save").disabled=!1})).catch((function(t){return console.log("Ошибочка вышла: ".concat(t," - ").concat(t.status))})),c().then((function(t){t.forEach((function(t){var e=g(t);v.append(e)}))})).catch((function(t){return console.log("Ошибочка вышла: ".concat(t))}))})();